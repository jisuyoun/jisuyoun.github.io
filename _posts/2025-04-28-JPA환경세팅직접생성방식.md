---
layout: single
title: "[Java] JPA í™˜ê²½ì„¸íŒ… - ì§ì ‘ ìƒì„± ë°©ì‹"
published: true
categories:
  - Java
tag:
  - Study
  - Java
---

JAVA 17 ë²„ì „ê³¼ ë§ˆë¦¬ì•„ DBë¥¼ ì‚¬ìš©í•˜ê³ , MAVEN í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í–ˆì„ ê²½ìš°ë¥¼ ê°€ì •í•œë‹¤.

# ì´ˆê¸° ì„¸íŒ…

## 1. ì˜ì¡´ì„± ì¶”ê°€

pom.xml íŒŒì¼ì— JPAì™€ ë§ˆë¦¬ì•„DB ë“œë¼ì´ë²„ ì˜ì¡´ì„±ì„ ì¶”ê°€í•œë‹¤.

```
<dependencies>
	<!-- JPA ì˜ì¡´ì„± (Hibernate) -->
	<dependency>
		<groupId>org.hibernate</groupId>
		<artifactId>hibernate-core</artifactId>
		<version>5.6.5.Final</version>
	</dependency>
	
	<!-- JPA API -->
	<dependency>
		<groupId>jakarta.persistence</groupId>
		<artifactId>jakarta.persistence-api</artifactId>
		<version>3.0.0</version>
	</dependency>
	
	<!-- MariaDB -->
	<dependency>
		<groupId>org.mariadb.jdbc</groupId>
		<artifactId>mariadb-java-client</artifactId>
		<version>2.7.3</version>
	</dependency>
</dependencies>
```

## 2. persistence.xml íŒŒì¼ ì„¤ì •

JPAì˜ ì„¤ì • ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” `persistence.xml` íŒŒì¼ì„ `src/main/resources/META-INF` ë””ë ‰í† ë¦¬ì— ìƒì„±í•œë‹¤. ì´ íŒŒì¼ì—ëŠ” **ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì •ë³´**ì™€ **JPA ê´€ë ¨ ì„¤ì •**ì´ í¬í•¨ë˜ì–´ ìˆë‹¤.

```
<persistence xmls="http://xmlns.jcp.org/xml/ns/persistence"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence
										http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd"
version="2.2">
	<persistence-unit name="myPersistenceUnit">
		<provider>org.hibernate.jpa.HibernatePersistenceProvider</provider>
		
		<class>models.TestEntity</class> <!-- ì—”í‹°í‹° í´ë˜ìŠ¤ -->
		
		<properties>
			<property name="jakarta.persistence.jdbc.driver" value="org.mariadb.jdbc.Driver" />
			<property name="jakarta.persistence.jdbc.url" value="jdbc:mariadb://localhost:3306/mydatabase" />
			<property name="jakarta.persistence.jdbc.user" value="username" />
			<property name="jakarta.persistence.jdbc.password" value="password" />
			<property name="hibernate.dialect" value="org.hibernate.dialect.MariaDBDialect" />
			<property name="hibernate.hbm2ddl.auto" value="update" /> <!-- ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„± -->
			<property name="hibernate.show_sql" value="true" /> <!-- ì¿¼ë¦¬ ë¡œê·¸ í‘œì‹œ -->
		</properties>
	</persistence-unit>
</persistence>
```

## 3. EntityManagerFactory ìƒì„±

EntityManagerFactoryë¥¼ ìƒì„±í•˜ì—¬ EntityManagerë¥¼ ì–»ëŠ” ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•œë‹¤.

```
import jakarta.persistence.EntityManager;
import jakarta.persistence.EntityManagerFactory;
import jakarta.persistence.Persistence;

public class JPAUtil {
	private static final EntityManagerFactory entityManagerFactory =
		Persistence.createEntityManagerFactory("myPersistenceUnit"); // persistence.xmlì— ì„¤ì •í•œ persistence-unit name
					
	public static EntityManager getEntityManager() {
		return entityManagerFactory.createEntityManager();
	}
	
	public static void close() {
		entityManagerFactory.close();
	}
}
```

## 4. EntityManager ì‚¬ìš©

ìœ„ ê³¼ì •ì„ ë‹¤ í–ˆìœ¼ë©´ EntityManagerë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

```
import jakarta.persistence.EntityTransaction;

public class TestService {
	private EntityManager entityManager;
	
	public TestService() {
		this.entityManager = JPAUtil.getEntityManager();
	}
	
	// TestEntity ì‚½ì…
	public void insertTestEntity(TestEntity entity) {
		EntityTransaction transaction = entityManager.getTransaction();
		try {
			transaction.begin();
			entityManager.persist(entity);
			transaction.commit();
		} catch (Exception e) {
			if (transaction.isActive()) {
				transaction.rollback();
			}
			e.printStackTrace();
		}
	}
}
```

## 5. ì–´í”Œë¦¬ì¼€ì´ì…˜ ì¢…ë£Œ ì‹œ EntityManagerFactory ë‹«ê¸°

```
public class Main {
	public static void main(String[] args) {
		TestService service = new TestService();
		// ë°ì´í„° ì‘ì—… ìˆ˜í–‰
		// ...
		JPAUtil.close();
	}
}
```

# CRUD ì‘ì—…-ì§ì ‘ ì£¼ì… ë°©ì‹

## 1. ì—”í‹°í‹° í´ë˜ìŠ¤ ì •ì˜

TEST_TABLEì´ë¼ëŠ” í…Œì´ë¸”ì— ID, TEST1, TEST2 ë¼ëŠ” ì»¬ëŸ¼ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆë‹¤ê³  ê°€ì •í•œë‹¤.

ì´ë¥¼ ë§¤í•‘í•˜ê¸° ìœ„í•œ ì—”í‹°í‹° í´ë˜ìŠ¤ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜í•  ìˆ˜ ìˆë‹¤.

```
package models;

import javax.persistence.*;

@Entity
@Table(name = "TEST_TABLE")
public class TestEntity {
	
	@id
	@GeneratedValue(strategy = GenerationType.IDENTITY)
	private Long id;
	private String test1;
	private String test2;
	
	// Getters and Setters
	
}
```

ğŸ’¡ entityManagerë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ì˜ì¡´ì„±ì„ ì£¼ì…í•´ì•¼í•œë‹¤. ì˜ì¡´ì„± ì£¼ì…ì€ í•˜ë‹¨ì— ì •ë¦¬í–ˆë‹¤.
{: .notice--info}

## 2. SELECT

ì¡°ê±´ì ˆì´ ì—†ì„ ë•Œì˜ ë©”ì†Œë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```
public List<TestEntity> getAllTestEntities() {
	String jpql = "SELECT t FROM TestEntity t";
	return entityManager.createQuery(jpql, TestEntity.class).getResultList(); // ë¦¬ìŠ¤íŠ¸ë¡œ ë°˜í™˜
}
```

ë§Œì•½ â€˜TEST1 ì»¬ëŸ¼ì´ íŠ¹ì • ë°ì´í„°ì¼ ê²½ìš°â€™ ë¼ëŠ” ì¡°ê±´ì´ ë¶™ì—ˆì„ ê²½ìš° ë‹¤ìŒê³¼ ê°™ë‹¤.

```
public List<TestEntity> getTestEntitiesByTest1(String test1Value) {
	String jpql = "SELECT t FROM TestEntity t WHERE t.test1 = :test1Value";
	return entityManager.createQuery(jpql, TestEntity.class)
						.setParameter("test1Value", test1Value)
						.getResultList();
}
```

ë§Œì•½ íŠ¹ì • seqë¥¼ ì¡°íšŒí•˜ê³ ì í•  ê²½ìš°ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì´ í•˜ë©´ ê°„ë‹¨í•˜ë‹¤.

ë§Œì•½ í•´ë‹¹ seqì˜ ì—”í‹°í‹°ê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš°ì—ëŠ” nullì„ ë°˜í™˜í•œë‹¤.
```
public TestEntity getTestEntityById(Long id) {
	return entityManager.find(TestEntity.class, id);
}
```

## 3. INSERT

```
public void insertTestEntity(TestEntity entity) {
	EntityTransaction transaction = entityManager.getTransaction();
	try {
		transaction.begin(); // íŠ¸ëœì­ì…˜ ì‹œì‘
		entityManager.persist(entity); // ì—”í‹°í‹° ì €ì¥
		transaction.commit();
	} catch (Exception e) {
		if (transaction.isActive()) {
			transaction.rollback(); // ì˜¤ë¥˜ ë°œìƒ ì‹œ ë¡¤ë°±
		}
		e.printStackTrace();
	}
}
```

## 4. UPDATE

```
public void updateTestEntity(Long id, String newTest1, String newTest2) {
	EntityTransaction transaction = entityManager.getTransaction();
	try {
		transaction.begin();
		TestEntity entity = entityManager.find(TestEntity.class, id); //ì—”í‹°í‹° ì¡°íšŒ
		if (entity != null) {
			entity.setTest1(newTest1);
			entity.setTest2(newTest2);
		}
		transaction.commit();
	} catch (Exception e) {
		if (transaction.isActive()) {
			transaction.rollback(); // ì˜¤ë¥˜ ë°œìƒ ì‹œ ë¡¤ë°±
		}
		e.printStackTrace();
	}
}
```

## 5. DELETE

```
public void deleteTestEntity(Long id) {
	EntityTransaction transaction = entityManager.getTransaction();
	try {
		transaction.begin();
		TestEntity entity = entityManager.find(TestEntity.class, id); // ì—”í‹°í‹° ì¡°íšŒ
		if (entity != null) {
			entityManager.remove(entity); // ì—”í‹°í‹° ì‚­ì œ
		}
		transaction.commit();
	} catch (Exception e) {
		if (transaction.isActive()) {
			transaction.rollback(); // ì˜¤ë¥˜ ë°œìƒ ì‹œ ë¡¤ë°±
		}
		e.printStackTrace();
	}
}
```