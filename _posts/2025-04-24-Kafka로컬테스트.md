ğŸ’¡ ZookeeperëŠ” ì„¤ì •ì„ ê±´ë“œë¦¬ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ í¬íŠ¸ë²ˆí˜¸ê°€ 2181ì´ê³ , KafkaëŠ” ê¸°ë³¸ í¬íŠ¸ë²ˆí˜¸ê°€ 9092ë‹¤.
{: .notice--primary}

[Kafka](../data/2025-04-23-Kafkaê°œë…ì •ë¦¬/) â‡’ ì¹´í”„ì¹´ ê°œë… ì •ë¦¬ í˜ì´ì§€
{: .notice--info}

# 1. Kafka ë¡œì»¬ í…ŒìŠ¤íŠ¸

[Kafka ê³µì‹ë¬¸ì„œ](https://kafka.apache.org/10/documentation.html#quickstart)

## 1.1. Zookeeper ì„¤ì¹˜ ë° ì‹¤í–‰

âœ‹ Zookeeper ì„¤ì¹˜ ë° ì‹¤í–‰ì€ Kafka 2.8.0 ë¯¸ë§Œ ë²„ì „ì„ ì‚¬ìš©í•  ì‹œì—ë§Œ í•´ë‹¹ëœë‹¤
{: .notice--danger}

[Apache ZooKeeper](https://zookeeper.apache.org/)

1. ìœ„ ì£¼ì†Œë¡œ ë“¤ì–´ê°€ Zookeeper ì¤‘ì—ì„œÂ **`-bin`**Â ìœ¼ë¡œ ëë‚˜ëŠ”Â **`tar.gz`**Â íŒŒì¼ì„ ë°›ì•„ì¤€ë‹¤.

    Apache-zookeeper-3.8.3.gz.tarì™€ ê°™ì€ íŒŒì¼ì„ ë°›ìœ¼ë©´, data í´ë”ê°€ ì—†ìœ¼ë‹ˆ, -bin ìœ¼ë¡œ ëë‚˜ëŠ” íŒŒì¼ ë°›ê¸°
    {: .notice--primary}
    
2. conf í´ë” ë‚´Â **`zoo-sample`**ì„ ë³µì‚¬í•œ í›„ ê°™ì€ ê²½ë¡œ(conf í´ë” ë‚´)Â ë¶™ì—¬ë„£ê¸° í•œ í›„Â **`zoo.cfg`**ë¡œ ì´ë¦„ì„ ë³€ê²½í•´ì¤€ë‹¤.
3. zoo.cfgë¥¼ ì—´ì–´Â **`dataDir={zookeeperê²½ë¡œ}/data`**ë¡œ ë³€ê²½í•´ì¤€ë‹¤.
4. cmd ì°½ì„ ì—´ì–´ì„œ {zookeeperê²½ë¡œ}/bin ìœ¼ë¡œ ì´ë™ í•œ í›„Â **`zkServer.cmd`**Â ë¥¼ ì…ë ¥í•˜ë©´ zookeeperê°€ ì‹¤í–‰ì´ ì™„ë£Œëœë‹¤.

ğŸ’¡ ì—¬ê¸°ì„œ Zookeeperê°€ ì‹¤í–‰ëœ cmd ì°½ì„ ë„ë©´ kafkaì™€ ì—°ê²°ë˜ì§€ ì•ŠëŠ”ë‹¤.
{: .notice--primary}

### Kafka 2.8.0 ë²„ì „ ì´ìƒ ì‚¬ìš©ì‹œ

[Apache Kafka](https://kafka.apache.org/downloads)

ìœ„ ì£¼ì†Œë¡œ ë“¤ì–´ê°€ì„œ Kafka ë‹¤ìš´ë¡œë“œí•œë‹¤.

í„°ë¯¸ë„ì—ì„œ ë‹¤ìš´ ë°›ì€ Kafka í´ë”ë¡œ ì´ë™ í›„ ì•„ë˜ ëª…ë ¹ì–´ ì…ë ¥

**`bin\windows\zookeeper-server-start.bat config\zookeeper.properties`**

![Image](https://github.com/user-attachments/assets/81954113-1f49-48a0-b78b-e5b3ea1f84c0)

## 1.2. Kafka ë‹¤ìš´ ë° ì‹¤í–‰

[Apache Kafka](https://kafka.apache.org/downloads)

1. ìœ„ ì£¼ì†Œì—ì„œ Kafka ë‹¤ìš´
    - Source download: Kafkaë¥¼ ì»¤ìŠ¤í…€í•˜ì—¬ ì‚¬ìš©í•  ê²½ìš° ë‹¤ìš´
        - ì°¸ê³ ) Sourceë¥¼ ë‹¤ìš´ ë°›ì•„ ì‚¬ìš©í•  ê²½ìš° Gradleì´ í•„ìš”í•˜ë‹¤.
    - Binary download: ì»¤ìŠ¤í…€ ì—†ì´ ë‹¨ìˆœ Kafka ì‚¬ìš©í•  ê²½ìš° ë‹¤ìš´
2. ë‹¤ìš´ ë°›ì€ Kafka í´ë”ì—ì„œ **`config â†’ server.properties`** ì—´ê¸°
3. **`log.dirs={Kafka ê²½ë¡œ}/logs`** ë¡œ ë³€ê²½
![Image](https://github.com/user-attachments/assets/2b995c54-00f9-48c2-976d-c8ca6cec26a5)

4. í„°ë¯¸ë„ì„ ì—´ì–´ Kafkaê°€ ì„¤ì¹˜ëœ ê²½ë¡œë¡œ ì´ë™ í›„ ì•„ë˜ ëª…ë ¹ì–´ ì…ë ¥í•˜ì—¬ Kafka ì‹¤í–‰
    
    **`bin\windows\kafka-server-start.bat config\server.properties`**
    
    ğŸ’¡ Kafka ë²„ì „ê³¼ ìƒê´€ì—†ì´ Zookeeperê°€ ì‹¤í–‰ë˜ì–´ ìˆëŠ” ìƒíƒœì—ì„œ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ì•¼ Kafkaê°€ ì‹¤í–‰ëœë‹¤ â€¼ï¸
    {: .notice--primary}
    
    

### 1.2.1. ë°œê²¬í•œ ì˜¤ë¥˜
<span style="color:red">`ì…ë ¥ ì¤„ì´ ë„ˆë¬´ ê¹ë‹ˆë‹¤. ëª…ë ¹ êµ¬ë¬¸ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.`</span>

í•´ë‹¹ ì˜¤ë¥˜ëŠ” ê²½ë¡œê°€ ë„ˆë¬´ ê¸¸ì–´ì„œ ë‚˜íƒ€ë‚˜ëŠ” ì˜¤ë¥˜ë¡œ, Cë“œë¼ì´ë¸Œ ë°‘ìœ¼ë¡œ ì˜®ê²¨ Kafka í´ë” ê²½ë¡œë¥¼ ì§§ê²Œ ë§Œë“¤ì–´ í•´ê²°í•˜ì˜€ë‹¤.

## 1.3. Topic ìƒì„±í•˜ê¸°

- Kafka 2.8.0 ì´ìƒ ì‚¬ìš©ì‹œ
    
    **`bin\windows\kafka-topics.bat --create --bootstrap-server localhost:{í¬íŠ¸ë²ˆí˜¸} --replication-factor 1 --partitions 1 --topic {í† í”½ëª…}`**


- Kafka 2.8.0 ë¯¸ë§Œ ì‚¬ìš©ì‹œ
    
    **`bin\windows\kafka-topics.bat --create --zookeeper localhost:{í¬íŠ¸ë²ˆí˜¸} --replication-factor 1 --partitions 1 --topic {í† í”½ëª…}`**
    

## 1.4. Topic ì¡°íšŒí•˜ê¸°

- Kafka 2.8.0 ì´ìƒ ì‚¬ìš©ì‹œ
    
    **`bin\windows\kafka-topics.bat --list --bootstrap-server localhost:{í¬íŠ¸ë²ˆí˜¸}`**
    
- Kafka 2.8.0 ë¯¸ë§Œ ì‚¬ìš©ì‹œ
    
    **`bin\windows\kafka-topics.bat --list --zookeeper localhost:{í¬íŠ¸ë²ˆí˜¸}`**
    

## 1.5. Producer, Consumer ì‹œì‘

- consumer ì‹¤í–‰ì‹œ
    - Kafka 2.8.0 ì´ìƒ ì‚¬ìš©ì‹œ
        
        **`bin\windows\kafka-console-consumer.bat --bootstrap-server localhost:{í¬íŠ¸ë²ˆí˜¸} --topic {í† í”½ëª…}`**
        
    - Kafka 2.8.0 ë¯¸ë§Œ ì‚¬ìš©ì‹œ
        
        **`bin\windows\kafka-console-consumer.bat --zookeeper localhost:{í¬íŠ¸ë²ˆí˜¸} --topic {í† í”½ëª…}`**
        
        ğŸ’¡consumerë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ topicì„ ë°œìƒí•  producerë¥¼ ì‹¤í–‰ì‹œí‚¤ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ, ì•„ë¬´ ê²ƒë„ ëœ¨ì§€ ì•ŠëŠ” ê²ƒì´ ì •ìƒì´ë‹¤.
        {: .notice--primary}
        

- producer ì‹¤í–‰ì‹œ
    
    `bin\windows\kafka-console-producer.bat â€“-broker-list localhost:{í¬íŠ¸ë²ˆí˜¸} --topic {í† í”½ëª…}`
    
- consumer - producer í…ŒìŠ¤íŠ¸ì‹œ
    1. consumerë¥¼ ì‹¤í–‰ì‹œí‚¨ í„°ë¯¸ë„ ì°½ì„ ë„ì§€ ì•Šê³ , ìƒˆë¡œìš´ í„°ë¯¸ë„ ì°½ì„ ì—´ì–´ producer ì‹¤í–‰
    2. producerì— consumerì— ë³´ë‚¼ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì˜€ì„ ë•Œ consumerë¥¼ ì‹¤í–‰ì‹œí‚¨ í„°ë¯¸ë„ì— í•´ë‹¹ ë©”ì‹œì§€ê°€ ëœ° ê²½ìš° Kafka consumer - producer í…ŒìŠ¤íŠ¸ ì™„ë£Œ
        

### 1.5.1. ë°œê²¬í•œ ì˜¤ë¥˜ë“¤
<span style="color:red;">`Exception in thread "main" joptsimple.UnrecognizedOptionException: zookeeper is not a recognized option`</span>

í•´ë‹¹ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ì›ì¸ì€ ì•„ë˜ì™€ ê°™ë‹¤.
- ëª…ë ¹ì–´ê°€ ì˜ ëª» ë˜ì—ˆì„ ê²½ìš°
- localhost:{í¬íŠ¸ë²ˆí˜¸}ì—ì„œ í¬íŠ¸ë²ˆí˜¸ê°€ ì˜ëª»ë˜ì—ˆì„ ê²½ìš°
í¬íŠ¸ë²ˆí˜¸ì˜ ê²½ìš° Kakfaë¥¼ ì„¤ì¹˜í•œ í›„ ë³€ê²½í•˜ì§€ ì•Šì•˜ë‹¤ë©´ ëŒ€ë¶€ë¶„ **9092**ê°€ í¬íŠ¸ë²ˆí˜¸ë‹¤.

ğŸ’¡í¬íŠ¸ë²ˆí˜¸ëŠ” Kafka ì„œë²„ ì‹¤í–‰ì‹œ ë‚˜íƒ€ë‚˜ëŠ” ë¡œê·¸ë“¤ ì¤‘ ë§¨ ë°‘ ì í˜€ìˆë‹¤. í¬íŠ¸ë²ˆí˜¸ê°€ ì˜ ëª» ëœ ê²½ìš°ì¼ ê²½ìš° Kafkaì˜ server.propertiesì—ì„œ listener=PLAINTEST:\localhost:{ì •ìƒì ì¸ í¬íŠ¸ë²ˆí˜¸}ë¡œ ë³€ê²½ í›„ Kafka ì„œë²„ë¥¼ ê»ë‹¤ì¼œì„œ ë‹¤ì‹œ ì‹¤í–‰ì„ í•´ë³¸ë‹¤. ë§Œì•½, í¬íŠ¸ ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ì§€ ì•Šì•˜ìŒì—ë„ ì‹¤í–‰ë˜ì§€ ì•Šì„ ê²½ìš° server.propertiesì—ì„œ `istener=PLAINTEST:\localhost:{ì •ìƒì ì¸ í¬íŠ¸ë²ˆí˜¸}`ë¡œ ë³€ê²½ í›„ Kafka ì„œë²„ë¥¼ ì¬ë¶€íŒ… í•´ë³¸ë‹¤.
{: .notice--primary}

## 1.6. Topic ì‚­ì œ

- Kafka 2.8.0 ì´ìƒ ì‚¬ìš©ì‹œ
    
    **`bin\windows\kafka-topics.bat --delete --bootstrap-server localhost:{portë²ˆí˜¸} --topic {ì‚­ì œí• í† í”½ëª…}`**
    
- Kafka 2.8.0 ë¯¸ë§Œ ì‚¬ìš©ì‹œ
    
    **`bin\windows\kafka-topics.bat --delete --zookeeper localhost:{portë²ˆí˜¸} --topic {ì‚­ì œí• í† í”½ëª…}`**
    

ğŸ’¡ ì‚­ì œí•  ë•Œ zookeeper ì„œë²„ì™€ ì—°ê²°ëœ ìƒíƒœì—¬ì•¼ ì‚­ì œê°€ ëœë‹¤! ì‚­ì œê°€ ì•ˆ ëœë‹¤ë©´ zookeeper ì„œë²„ì™€ ì—°ê²°í•œ í„°ë¯¸ë„ì´ êº¼ì§„ ê²ƒì€ ì•„ë‹Œì§€ í™•ì¸í•˜ê¸°
{: .notice--danger}


### 1.5.1. ë°œê²¬í•œ ì˜¤ë¥˜
<span style="color:red">`removed fetcher for partitions`</span>

ìœˆë„ìš°ì—ì„œ Topic ì‚­ì œì‹œ í•´ë‹¹ ì˜¤ë¥˜ê°€ ëœ¨ë©´ì„œ kafkaê°€ ì—°ê²°ë˜ì§€ ì•ŠëŠ” ì˜¤ë¥˜ê°€ ìˆëŠ”ë°, í•´ë‹¹ ì˜¤ë¥˜ ë°œìƒ ì‹œ kafka ë¡œê·¸(./tmp) í´ë”ì—ì„œ kafka ê´€ë ¨ í´ë”ë¥¼ ì‚­ì œí•´ì•¼ í•œë‹¤. <span style="color:red">ë‹¤ë§Œ, ì‚­ì œí•  ê²½ìš° ì§€ê¸ˆê¹Œì§€ ë§Œë“  í† í”½ë“¤ì´ ì‚­ì œë˜ë‹ˆ ì£¼ì˜ì˜</span>


<span style="color:red">`already marked for deletion`</span>

í† í”½ ì‚­ì œ ì„¤ì •ì„ í•˜ì§€ ì•Šì•„ ìƒê¸´ ë¬¸ì œë¡œ, config í´ë” ë‚´ server.properties íŒŒì¼ì— **`delete.topic.enable=true`**ë¥¼ ì¶”ê°€í•´ì¤€ í›„ zookeeperì™€ kafka ì„œë²„ë¥¼ ë‹¤ì‹œ ì—°ê²°í•œë‹¤.
ë˜ëŠ”, zookeeper shellì—ì„œ rmr ëª…ë ¹ì–´ë¥¼ í†µí•´ ì™„ì „íˆ ì‚­ì œí•˜ëŠ” ë°©ë²•ë„ ìˆë‹¤.
```
bin\windows\zookeeper-shell.bat localhost:2181
ls /broker/topics

rmr /brokers/topics/morpheme.t
```

# 2. ìë°” ì¹´í”„ì¹´ í…ŒìŠ¤íŠ¸ ì†ŒìŠ¤

[Java - Kafka ì—°ê²°](https://www.notion.so/Java-Kafka-dce7c49da4c24443889ef1897ff85209?pvs=21)

[kafka/streams/examples/src/main/java/org/apache/kafka/streams/examples at 1.0 Â· apache/kafka](https://github.com/apache/kafka/tree/1.0/streams/examples/src/main/java/org/apache/kafka/streams/examples)

ìœ„ ì£¼ì†ŒëŠ” ê¹ƒí—ˆë¸Œ ì£¼ì†Œë¡œ, 1.0 ë²„ì „ì´ë¯€ë¡œ, ë‹¤ë¥¸ ë²„ì „ ì‚¬ìš©ì‹œ í•´ë‹¹ ê¹ƒí—ˆë¸Œì—ì„œ branchë¥¼ ì•Œë§ì€ ë²„ì „ìœ¼ë¡œ ë³€ê²½í•´ì„œ ì†ŒìŠ¤ë¥¼ ì°¸ê³ í•˜ë©´ ëœë‹¤.

## 2.1. application.yml

```
spark:
  streaming-context:
    duration:
      unit: seconds
      value: 1
spring:
    kafka:
        consumer:
            bootstrap-servers: localhost:9092
            group-id: myGroup
            auto-offset-reset: earliest
            key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
            value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
        producer:
            bootstrap-servers: localhost:9092
            key-serializer: org.apache.kafka.common.serialization.StringSerializer
            value-serializer: org.apache.kafka.common.serialization.StringSerializer
```

### 2.1.1. ë°œê²¬í•œ ì˜¤ë¥˜ë“¤
```
[Consumer clientId=consumer-1, groupId=event1] Fetch READ_UNCOMMITTED at offset 0 for partition test_real-0 returned fetch data (error=NONE, highWaterMark=0, lastStableOffset = -1, logStartOffset = 0, abortedTransactions = null, recordsSizeInBytes = 0)
[Consumer clientId=consumer-1, groupId=event1] Added READ_UNCOMMITTED fetch request for partition test_real-0 at offset 0 to node DESKTOP-R87846Q:9092 (id: 0 rack: null)
[Consumer clientId=consumer-1, groupId=event1] Sending READ_UNCOMMITTED fetch for partitions [test_real-0] to broker DESKTOP-R87846Q:9092 (id: 0 rack: null)
```

ìë°”ì—ì„œ kafkaë¥¼ ì‹¤í–‰ ì‹œ ìœ„ì™€ ê°™ì€ ì˜¤ë¥˜ê°€ ë°˜ë³µì ìœ¼ë¡œ ëœ¨ê³ , ë°ì´í„°ê°€ producerë¡œ ì´ë™ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤.
í•´ë‹¹ ë¬¸ì œì˜ ì›ì¸ì€ consumerì— ë°ì´í„°ê°€ ì—†ëŠ”ë° ì½ì–´ì˜¬ ë•Œ ìƒê¸°ëŠ” ì˜¤ë¥˜ë‹¤.

í•´ê²° ë°©ë²•ì€
1. kafka ì„¤ì •ì—ì„œ auto-offset-resetì´ latestë¡œ ë˜ì–´ìˆëŠ”ì§€ í™•ì¸í•œ í›„ ë˜ì–´ìˆë‹¤ë©´ earliestìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ê°€ì¥ ì²˜ìŒ ì˜¤í”„ì…‹ë¶€í„° ì½ëŠ” ê²ƒìœ¼ë¡œ ë³€ê²½í•´ì¤€ë‹¤.
2. producerì— ë°ì´í„°ê°€ ì˜ ë“¤ì–´ê°”ëŠ”ì§€ kafka-console-producer.batì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ê°€ ë“¤ì–´ê°„ ê²ƒì´ ë§ëŠ”ì§€ í™•ì¸í•œë‹¤.

### 2.1.2. ìƒì„±ëœ group ì¡°íšŒ

**`bin\windows\kafka-consumer-group.bat --bootstrap-server localhost:{portë²ˆí˜¸} --list`**

### 2.1.3. offset ì¡°íšŒ ë° ì´ˆê¸°í™”

Producerë¡œ ë°ì´í„°ê°€ ì˜ ë“¤ì–´ê°€ ìˆìŒì—ë„ consumerì—ì„œ ì¶œë ¥í•˜ì§€ ëª»í•  ê²½ìš°
ëª¨ë“  offsetì„ ì½ì–´ ë”ì´ìƒ ì½ì„ ë°ì´í„°(offset)ì´ ì—†ì–´ ì½ì–´ì˜¤ì§€ ëª»í•˜ëŠ” ê²ƒ ì¼ ìˆ˜ë„ ìˆë‹¤.

1. offset ì¡°íšŒ
    - Kafka 2.8.0 ì´ìƒ ì‚¬ìš©ì‹œ
        
        **`bin\windows\kafka-consumer-groups.bat --bootstrap-server localhost:{portë²ˆí˜¸} â€”-describe -â€”group {groupId}`** 
        
    - Kafka 2.8.0 ë¯¸ë§Œ ì‚¬ìš©ì‹œ
        
        **`bin\windows\kafka-consumer-groups.bat --zookeeper localhost:{portë²ˆí˜¸} â€”-describe -â€”group {groupId}`**
        
        ğŸ’¡ CURRENT-OFFSET: ì¡°íšŒëœ ë°ì´í„°ì˜ ê°œìˆ˜
        LOG-END-OFFSET: ë§ˆì§€ë§‰ìœ¼ë¡œ ì¡°íšŒëœ ë°ì´í„°ì˜ ë²ˆí˜¸
        {: .notice--primary}
        
2. offset ì´ˆê¸°í™”
    - Kafka 2.8.0 ì´ìƒ ì‚¬ìš©ì‹œ
        
        **`bin\windows\kafka-consumer-groups.bat --bootstrap-server localhost:{portë²ˆí˜¸} --group {groupId} --reset-offsets --to-earliest --topic {í† í”½ëª…} --execute`**
        
    - Kafka 2.8.0 ë¯¸ë§Œ ì‚¬ìš©ì‹œ
        
        **`bin\windows\kafka-consumer-groups.bat --zookeeper localhost:{portë²ˆí˜¸} --group {groupId} --reset-offsets --to-earliest --topic {í† í”½ëª…} --execute`**
        
3. ë°œê²¬í•œ ì˜¤ë¥˜
<span style="color:red;">`Assignments can only be reset if the group 'myGroup' is inactive, but the current state is Stable.`</span>
    
```
C:\kafka> .\bin\windows\kafka-consumer-groups.bat --bootstrap-server localhost:9092 --describe --group myGroup

GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                             HOST            CLIENT-ID
myGroup         myTopic         0          14              14              0               consumer-myGroup-1-365e21b7-70f4-42f4-82d7-f307644efbc0 /192.168.56.1   consumer-myGroup-1
PS C:\kafka> .\bin\windows\kafka-consumer-groups.bat --bootstrap-server localhost:9092 --group myGroup --reset-offsets --to-earliest --topic myTopic --execute

Error: Assignments can only be reset if the group 'myGroup' is inactive, but the current state is Stable.

GROUP                          TOPIC                          PARTITION  NEW-OFFSET
```

1. Consumer ê·¸ë£¹ ìƒíƒœ í™•ì¸: **`.\bin\windows\kafka-consumer-groups.bat --bootstrap-server localhost:9092 --describe --group myGroup`**
2. Consumer ê·¸ë£¹ ì‚­ì œ:  **`.\bin\windows\kafka-consumer-groups.bat --bootstrap-server localhost:9092 --group myGroup --delete`**
3. offset ì¬ì„¤ì •: **`.\bin\windows\kafka-consumer-groups.bat --bootstrap-server localhost:9092 --group myGroup --reset-offsets --to-earliest --topic myTopic --execute`**
